# Errors (_@ihr-radioedit/errors_)

<img src="../../logo.svg" width="350">

### Part of the [RadioEdit Library](../../README.md)

Setup, build and publish instructions located there.

## Purpose

The Errors package provides a base class for all errors used by the RadioEdit library. It includes a set of built-in
error types as well as helpers for converting errors to JSON and back again, and extracting error info from objects
of unknown type.

## Autogenerated Docs

Autogenerated documentation describing class structure and parameters available [here](../../docs/errors/README.md)

## Usage

```typescript
import { CombinedError, registerErrorDeserializer, WireError } from '@ihr-radioedit/errors';

class BadBunnyError extends ErrorBase<{ status: string }> {
    code = "BAD_BUNNY";
    status = "";

    // Convenience function to accept some error details and make an instance.
    static fromStatus(status: string, message?: string) {
        const error = new BadBunnyError(message ?? status);
        error.status = status;

        return error;
    }

    // Function to deserialize from ErrorData.
    static fromErrorData(data: ErrorData<{ status: string }>) {
        const error = new BadBunnyError(data.message);
        err.stack = data.stack;
        error.status = data.detail?.status ?? "";

        return error;
    }

    toErrorData() {
        return {
            name: this.name,
            message: this.message,
            stack: this.stack,
            code: this.code,
            detail: { status: "Bunny out of box. Put the bunny back in the box." },
        };
    }
}

// Register the error type so it can be deserialized from its ErrorData format.
registerErrorDeserializer("BadBunnyError", BadBunnyError.fromErrorData);

// By default, toErrorData() is called when the error is converted to JSON.
console.log(JSON.stringify(new BadBunnyError("Bunny got issues.")));

// A WireError is a special type that provides a fallback when deserializing an error type that is not registered.
// It can also represent an unknown error type that we parse into the ErrorData format.
const hydratedError = WireError.from({
    name: "BadBunnyError",
    message: "Bunny got issues.",
    stack: "BadBunnyError: Bunny got issues.\n    at serverCall:150:10",
    code: "BAD_BUNNY",
    detail: { status: "Bunny out of box. Put the bunny back in the box." },
});
console.log(hydratedError.stack); // WireError: Bunny got issues.\n    at clientCall:13:30
console.log(hydratedError.data?.stack); // BadBunnyError: Bunny got issues.\n    at serverCall:150:10

// A CombinedError is a special error type that combines multiple errors into one.
const combinedError = new CombinedError(
    [new BadBunnyError("Bunny got issues."), new BadBunnyError("Bunny got more issues.")],
    "Overall message",
    "OVERALL_CODE"
);
console.log(combinedError.toErrorData()); // Includes overall message and code, and an array of ErrorData objects.


```

## Error Data Exraction

The `ErrorData` interface is used to represent errors in JSON format. All instances of `ErrorBase` will serialize to
this format. This library also provides a helper function for extracting error data from an object of unknown type.

```typescript
import { errorData } from '@ihr-radioedit/errors';

const error = new Error("Bunny got issues.");
console.log(errorData(error));
/*
{
    name: "Error",
    message: "Bunny got issues.",
    code: "UNKNOWN_ERROR",
    stack: "Error: Bunny got issues.\n    at <anonymous>:1:1",
    detail: undefined,
}
 */

```
