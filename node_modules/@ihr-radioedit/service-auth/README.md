# Auth Service (_@ihr-radioedit/service-auth_)

<img src="../../logo.svg" width="350">

### Part of the [RadioEdit Library](../../README.md)

Setup, build and publish instructions located there.

## Purpose

The Auth Service manages user and role information (including permissions) for the RadioEdit platform. This library
provides client code for managing auth principals (users and roles), getting principal data from access tokens, and
working with security policies.

## Autogenerated Docs

Autogenerated documentation describing class structure and parameters available [here](../../docs/auth/README.md)

## Sample Code

The most common use case is to get the current user's principal information from an access token (either explicitly
or via cookie).

Example:

```typescript
import { AuthClient } from "@ihr-radioedit/service-auth";

const client = AuthClient.auto();
const me = await client.getMyPrincipal().ifLeft(e => console.error(e)).orDefault(null);
console.log(me);

```

## Policy Evaluator

Applications can use this to implement their own security policies. Policies are defined as a set of rules, each of
which is an observer or visibility check.

An entity is "visible" to a principal if the principal's observer list intersects with the entity's membership list
(with an optional capability check, where a matching observer must also include the capability). The observer check
passes if the principal's observer list contains at least one entry matching the policy rule's member param (and
optional capability).

A policy rule has the following properties:

* **op**: one of "is_visible" or "has_observer"
* **member**: a member tag
* **cap**: an optional capability
* **actions**: a list of actions to apply if the user satisfies the rule. Valid actions are:
    * **read**: allow the user to see the entity
    * **write**: the user can modify the entity
    * **delete**: the user can delete the entity
    * **grant**: the user can set memberships on an entity that they don't have matching observers for.
    * **all**: all of the above

### Definitions

* **Principal**: A user or role
* **Entity**: A resource in ObjectDB (originally) or an application specific resource.
* **Observer**: A pair of member tag and optional app-specific capability,
  e.g. `{mem: "apps/my-app", cap: "manage:things"}`
* **Membership**: A list of tags denoting a group that an app entity belongs to.
