# `@ihr-radioedit/sdk-network`

Standard interface and utilties for making HTTP requests. Supports automatic retry, request/response interceptors,
and multiple adapter implementations.

## Usage

```typescript
import { getAdapter } from "@ihr-radioedit/sdk-network";

const Adapter = getAdapter();
const client = new Adapter({ defaultOptions: { baseUrl: "https://example.com" } });
const result = await client.get("some/path");

if (result.isLeft()) {
    // We know this is a NetworkError
    console.error(result.extract());
} else if (result.isRight()) {
    // We know this is a NetworkResponse
    console.log("Response:", result.extract());
} else {
    throw new Error("This can't happen.");
}

```

This code works as long as at least one adapter is registered. Register an adapter by importing it at application
start, e.g.:

```typescript
import "@ihr-radioedit/network-fetch";
import { startServer } from "./server";

startServer();

```

## Autogenerated Docs

Autogenerated documentation describing class structure and parameters available [here](../../docs/sdk-network/README.md)

## Client Configuration

A client instance can be configured with default request options that apply to all requests (optionally overridden
by options passed at request time). Client configuration also supports request/response interceptors, and a logger
instance for logging request/response data.

### Interceptors

Interceptors are callbacks that run at particular points in the request/response lifecycle. Request interceptors
optionally modify the final request options (merged with defaults) before the request is sent. Response interceptors
optionally modify the final response (or error in the case of failure) before it is returned to the caller.

## Request Options

Adapters implementing this library's interfaces support a standard set of request options. These options include the
usual suspects like query string params and headers, but also support for automatic retry, abort signals, and timeouts.
The `RequestOptions` object is also extensible, allowing adapters to support additional options specific to their
operation.

## Adapters

This library provides a `NetworkClientInterface` for performing requests, and an abstract `NetworkAdapter` class for
implementing the interface. Adapters receive request data in a standard format (which can be extended to support
adapter-specific options) and return an `EitherAsync` resolving to either a standard `NetworkResponse`
or `NetworkError`.

There is also a registration mechanism for adapters, which allows applications to override the default adapter class
and/or register additional adapters. (Note: all `@ihr-radioedit/network-*` adapter implementations will to
register themselves automatically, and the first to register will become default.)

In general, applications or libraries should use `getAdapter()` to retrieve the default adapter class, and not worry
about the details of the adapter implementation. That said, it's possible to supply options for multiple adapters,
if doing so would enhance functionality.

```typescript
import { getAdapter } from "@ihr-radioedit/sdk-network";

const Adapter = getAdapter();
const client = new Adapter({ defaultOptions: { baseUrl: "https://example.com" } });
const result = await client.get("some/path", {
    adapterOptions: {
        // These options will apply when fetch is the default adapter.
        fetch: {
            fetchOptions: {
                redirect: "no-follow",
            },
        },
        // These options will apply when axios is the default adapter.
        axios: {
            someAdapterOption: "some value", // Not an axios option, but the adapter supports it.
            axiosOptions: {
                onUploadProgress: (progressEvent) => console.log(progressEvent),
            },
        },
    },
});
console.log(result.extract());
```

## Helpers

This library includes a number of helper functions for common tasks, mostly for supporting adapter implementations,
but also a few for callers making requests, such as converting a request body to JSON, or getting a URL for a RadioEdit
service. See auto-generated docs for more details.

## Environment

The following environment variables are supported for overriding default library behaviors:

**Note:** All values are strings.

| Property              | Description                                                                                                                                              | Default  |
|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| `NETWORK_HTTP_SCHEME` | Default URI scheme used for HTTP requests (for *development only* â€” all requests in production should use defaults). One of: INSECURE, SECURE, RELATIVE. | RELATIVE |

## Other Constants

The following constants are exported by this library:

| Constant Name         | Description                                                     |
|-----------------------|-----------------------------------------------------------------|
| `HttpMethod`          | Enum of common HTTP methods.                                    |
| `HttpStatus`          | Enum of common HTTP status codes.                               |
| `RetryStrategies`     | Enum of supported backoff strategies for retries.               |
| `RETRY_DEFAULT_CODES` | List of HTTP status codes that will trigger a retry by default. |
| `Scheme`              | Enum of common URI schemes (protocols)                          |
